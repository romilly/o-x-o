
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Playing the game &#8212; MENACE Revisited</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Implementing A Simplified MENACE Player" href="chapter-7.html" />
    <link rel="prev" title="Finding the next move" href="chapter-5.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/Tic_Tac_Toe.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">MENACE Revisited</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="an-introduction.html">
   Reinforcement Learning From The Ground Up
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-1.html">
   Reinforcement Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-2.html">
   Reinforcement Learning with MENACE
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-3.html">
   Exploring the game
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-4.html">
   Possible games
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-5.html">
   Finding the next move
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Playing the game
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-7.html">
   Implementing A Simplified MENACE Player
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="appendix-a.html">
   Appendix A - Exploring Dyalog APL
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="appendix-b.html">
   Ten minutes to RIDE
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="appendix-c.html">
   Running MENACE In RIDE
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="about-the-author.html">
   About the author
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/chapter-6.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/romilly/o-x-o"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/romilly/o-x-o/issues/new?title=Issue%20on%20page%20%2Fchapter-6.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/romilly/o-x-o/master?urlpath=tree/chapter-6.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#types-of-player">
   Types Of Player
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-game-runner-code">
   The Game Runner Code
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#namespaces-in-dyalog-apl">
     Namespaces in Dyalog APL
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#retaining-data-across-multiple-sessions">
     Retaining data across multiple sessions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-menace-configuration">
   The MENACE configuration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   Playing The Game
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="playing-the-game">
<h1>Playing the game<a class="headerlink" href="#playing-the-game" title="Permalink to this headline">¶</a></h1>
<p>In this chapter we’ll explore the code that will run a game of Noughts and Crosses.</p>
<div class="section" id="types-of-player">
<h2>Types Of Player<a class="headerlink" href="#types-of-player" title="Permalink to this headline">¶</a></h2>
<p>The ultimate goal is to create a framework that makes it easy to run MENACE with a variety of different player types.</p>
<p>Eventually we’ll implement</p>
<ol class="simple">
<li><p>a <code class="docutils literal notranslate"><span class="pre">random_player</span></code> player function which will pick a legal move at random, and</p></li>
<li><p>a <code class="docutils literal notranslate"><span class="pre">menace_player</span></code> function that learns by using MENACE’s strategy to chose which move to make.</p></li>
<li><p>a <code class="docutils literal notranslate"><span class="pre">human_player</span></code> function that enables a human to play one side of the game.</p></li>
<li><p>a <code class="docutils literal notranslate"><span class="pre">perfect_player</span></code> function which makes the best possible moves throughout the game.</p></li>
</ol>
<p>In this chapter we will implement the <code class="docutils literal notranslate"><span class="pre">random_player</span></code>.</p>
<p>I don’t yet know a way to capture user input from a program running in an APL jupyter notebook, but it’s easy to do when running a program using Dyalog’s <a class="reference external" href="https://www.dyalog.com/dyalog/development-environment.htm">RIDE</a> interface. Appendix B (currently under construction) will describe how to run a version of MENACE that also supports a <code class="docutils literal notranslate"><span class="pre">human_player</span></code>.</p>
<p>Each of these players will be implemented as an APL function which will take the current MENACE configuration as an argument, make a move and return an updated configuration as its result.</p>
</div>
<div class="section" id="the-game-runner-code">
<h2>The Game Runner Code<a class="headerlink" href="#the-game-runner-code" title="Permalink to this headline">¶</a></h2>
<p>We’ll plug the players into a <code class="docutils literal notranslate"><span class="pre">game_runnner</span></code> which we will implement as a <em>user-defined</em> operator.</p>
<p>Recall that in APL, a <em>function</em> returns data but an <em>operator</em> returns a function. Our <code class="docutils literal notranslate"><span class="pre">game_runner</span></code> will take a pair of player functions as arguments and return a function that will play an entire game.</p>
<p>That function will take an argument that captures the MENACE configuration and return an updated configuration as its result.</p>
<p>It’s possible to use a nested array to hold the configuraton data but that would requre the code to know positional information. In software we can dientify data by position or by name. In this case, using meaningful names will help readability. In APL we can use a new type of data structure called a *namespace’.</p>
<div class="section" id="namespaces-in-dyalog-apl">
<h3>Namespaces in Dyalog APL<a class="headerlink" href="#namespaces-in-dyalog-apl" title="Permalink to this headline">¶</a></h3>
<p>One use of namespaces is to represent hierarchical data structures.</p>
<p>We’ll create a two-level structure to represent a configuration. The top level will contain data like anticipated postions and their bead counts. It will contain a nested structure that has information about the game in progress.</p>
</div>
<div class="section" id="retaining-data-across-multiple-sessions">
<h3>Retaining data across multiple sessions<a class="headerlink" href="#retaining-data-across-multiple-sessions" title="Permalink to this headline">¶</a></h3>
<p>In this chapter we will assume that all the games are played in a single session. In the next chapter we will implement a simple way of retaining that data so that MENACE can learn across multiple sessions.</p>
</div>
</div>
<div class="section" id="the-menace-configuration">
<h2>The MENACE configuration<a class="headerlink" href="#the-menace-configuration" title="Permalink to this headline">¶</a></h2>
<p>The MENACE configuration will contain the information needed by the players and the <code class="docutils literal notranslate"><span class="pre">game_runner</span></code>.</p>
<p>Throughout a game <em>all</em> player types need to know the configuration for the current board. If we track the moves actually made during a game, the current board is simply the last of the moves in the current game, so the game history contains it.</p>
<p>Eventually we may want to examine MENACE’s performance over time. For that reason the configuration will maintain a history of wins, draws and losses. The <code class="docutils literal notranslate"><span class="pre">game_runner</span></code> will maintain that information but the player functions will ignore it.</p>
<p>The original version of MENACE chose its moves and tracked their value by using beads in a matchbox. If a matchbox was used during a game its contents were adjusted when the game was over.</p>
<p>A player that applies MENACE’s strategy needs to access and update that information so we will eventually need to include it in the MENACE configuration. It’s not needed by a <code class="docutils literal notranslate"><span class="pre">random_player</span></code> so we will omit it for now.</p>
<p>In summary, then, we will start with a MENACE Namespace that contains two sorts of data:</p>
<ol class="simple">
<li><p>A history of the current <code class="docutils literal notranslate"><span class="pre">game</span></code>, held as a matrix of position vectors, one row per move.</p></li>
<li><p>A vector of MENACE’s game <code class="docutils literal notranslate"><span class="pre">results</span></code>. A win is represented by 1, a draw by 0 and a loss by ¯1.</p></li>
</ol>
<p>We’ll start with the usual dance :)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">)</span><span class="nv">copy</span> <span class="nv">notebook6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">done
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">./notebook6.dws saved Sat Dec 19 14:41:35 2020
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕io</span> <span class="kd">←</span> <span class="m">0</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can create the initial configuration as a Namespce. We do that by using the system function</p>
<p>The first element contains the current board position. Initially that should be an empty board.
The second element contains the results of all games played, which should initially be set to be an empty vector.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">config</span> <span class="kd">←</span> <span class="nf">⎕ns</span> <span class="s1">&#39;&#39;</span>
<span class="nv">config</span><span class="na">.</span><span class="nv">game</span> <span class="kd">←</span> <span class="m">1</span> <span class="m">9</span><span class="o">⍴</span><span class="m">0</span>
<span class="nv">config</span><span class="na">.</span><span class="nv">results</span> <span class="kd">←</span> <span class="no">⍬</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id1">
<h2>Playing The Game<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Now we can start work on the <code class="docutils literal notranslate"><span class="pre">game_runner</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">game_runner</span></code> will be something we haven’t met before: a <em>user-defined operator</em>.</p>
<p>Recall that in APL a function returns data but an operator returns a function.</p>
<p>We’ve encountered two types of APL function: <em>primitive</em> functions like <code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">⍴</span></code>, <code class="docutils literal notranslate"><span class="pre">⌽</span></code> which are built into the APL interpreter, and<em>user-defined</em> functions, like <code class="docutils literal notranslate"><span class="pre">initial_counts</span></code> where we named APL code so that we could reuse it wherever it was needed without having to repeat the code.</p>
<p>We’ve also encoutered a number of primitive operators, like reduction <code class="docutils literal notranslate"><span class="pre">/</span></code> and outer product <code class="docutils literal notranslate"><span class="pre">∘.</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">game_runner</span></code> needs to cope with different types of player, and we will do that by providing player functions as arguments to <code class="docutils literal notranslate"><span class="pre">game_player</span></code>.</p>
<p>A typical game would look like this:
<code class="docutils literal notranslate"><span class="pre">config</span> <span class="pre">←</span> <span class="pre">menace_player</span> <span class="pre">game_runner</span> <span class="pre">random_player</span> <span class="pre">config</span></code>
where <code class="docutils literal notranslate"><span class="pre">config</span></code> is the MENACE configuration data we discussed above and <code class="docutils literal notranslate"><span class="pre">menace_player</span></code> and <code class="docutils literal notranslate"><span class="pre">random_player</span></code> are the functions we desicribed at the beginning of this chapter.</p>
<p>Let’s start by defining a <code class="docutils literal notranslate"><span class="pre">random_player</span></code> as it’s simpler to implement.</p>
<p>We’ll invoke the function by providing a menace configuration as its argument. That contains the current board configuration, and the <code class="docutils literal notranslate"><span class="pre">random_player</span></code> function should</p>
<ol class="simple">
<li><p>pick a legal move at random, and then</p></li>
<li><p>update the configuration appropriately and return it as the result.</p></li>
</ol>
<p>The second step is a little more compicated than it seems, because the <em>player doesn’t know whether it’s playing <code class="docutils literal notranslate"><span class="pre">×</span></code> or <code class="docutils literal notranslate"><span class="pre">○</span></code></em>. Luckily it can find that out from the current board position. If the numbers of ‘<code class="docutils literal notranslate"><span class="pre">×</span></code>’s and <code class="docutils literal notranslate"><span class="pre">○</span></code>’s are the same, it’s <code class="docutils literal notranslate"><span class="pre">×</span></code> to play. If not, it’s <code class="docutils literal notranslate"><span class="pre">○</span></code>’s turn.</p>
<p>Let’s build the code step by step.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">g</span> <span class="kd">←</span> <span class="nv">config</span><span class="na">.</span><span class="nv">game</span> <span class="c1">⍝ find the game so far</span>
<span class="o">⊢</span><span class="nv">cp</span> <span class="kd">←</span> <span class="o">,</span><span class="m">¯1</span><span class="o">↑</span><span class="nv">g</span> <span class="c1">⍝ find current position</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 0 0 0 0 0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">e</span> <span class="kd">←</span> <span class="m">0</span><span class="o">=</span><span class="nv">cp</span>   <span class="c1">⍝ boolean vector of empty board positions - a 1 means the position is available</span>
<span class="o">⊢</span><span class="nv">c</span> <span class="kd">←</span> <span class="o">+</span><span class="na">/</span><span class="nv">e</span> <span class="c1">⍝ how many empty squares are there? (At the start of the game, all of them).</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">9
</span></div></div>
</div>
<p>The player neets to pick an empty position at random.</p>
<p>Surprise, surprise! APL has a primitive function to do that.</p>
<p><em>Roll</em> is represetned by <code class="docutils literal notranslate"><span class="pre">?</span></code>. It returns a random number in the range specied by its right argument.
So <code class="docutils literal notranslate"><span class="pre">?5</span></code> will return a number between zero and four (inclusive), assuming that ⎕io is zero.</p>
<p>We’ll use it to pick a move at random and then update the game.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">i</span> <span class="kd">←</span> <span class="o">⍸</span><span class="nv">e</span> <span class="c1">⍝ find indices of the empty positions - these are the legal moves</span>
<span class="nv">np</span> <span class="kd">←</span> <span class="kt">{</span><span class="m">1</span><span class="o">+&gt;</span><span class="na">/</span><span class="o">+</span><span class="na">/</span><span class="m">1</span> <span class="m">2</span><span class="na">∘.</span><span class="o">=</span><span class="bp">⍵</span><span class="kt">}</span> <span class="c1">⍝ who is the next player? 1 for ×, 2 for ○</span>
<span class="nv">cp</span><span class="sr">[</span><span class="nv">i</span><span class="sr">[</span><span class="o">?⍴</span><span class="nv">i</span><span class="sr">]]</span> <span class="kd">←</span> <span class="nv">np</span> <span class="nv">cp</span> <span class="c1">⍝ pick a legal move at random and update the current position</span>
<span class="nv">cp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 1 0 0 0 0 0
</span></div></div>
</div>
<p>Next, we’ll update the current game by appending the new position to the matrix of moves and put the updated game into the configuration.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">g</span> <span class="kd">←</span> <span class="nv">g</span><span class="o">⍪</span> <span class="nv">cp</span> 
<span class="nv">config</span><span class="na">.</span><span class="nv">game</span> <span class="kd">←</span> <span class="nv">g</span>
</pre></div>
</div>
</div>
</div>
<p>Now we’ll create functions to access and update the configuration. These hide the internal structure of the configuration, making it easier to change later if we need to.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">p</span> <span class="kd">←</span> <span class="kt">{</span><span class="o">,</span><span class="m">¯1</span><span class="o">↑</span><span class="bp">⍵</span><span class="kt">}</span> <span class="c1">⍝ current position from game</span>
</pre></div>
</div>
</div>
</div>
<p>We can combine all those steps into the <code class="docutils literal notranslate"><span class="pre">random_player</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">random_player</span> <span class="kd">←</span> <span class="kt">{</span><span class="nv">g</span> <span class="kd">←</span> <span class="bp">⍵</span><span class="na">.</span><span class="nv">game</span> <span class="p">⋄</span> <span class="nv">cp</span> <span class="kd">←</span> <span class="nv">p</span> <span class="nv">g</span> <span class="p">⋄</span> <span class="nv">i</span> <span class="kd">←</span> <span class="o">⍸</span><span class="nv">e</span><span class="kd">←</span><span class="m">0</span><span class="o">=</span><span class="nv">cp</span> <span class="p">⋄</span> <span class="nv">cp</span><span class="sr">[</span><span class="nv">i</span><span class="sr">[</span><span class="o">?+</span><span class="na">/</span><span class="nv">e</span><span class="sr">]]</span> <span class="kd">←</span> <span class="nv">np</span> <span class="nv">cp</span> <span class="p">⋄</span> <span class="bp">⍵</span><span class="na">.</span><span class="nv">game</span> <span class="kd">←</span> <span class="nv">g</span><span class="o">⍪</span><span class="nv">cp</span> <span class="p">⋄</span> <span class="bp">⍵</span> <span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s try it out.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">config</span><span class="na">.</span><span class="nv">game</span> <span class="kd">←</span> <span class="m">1</span> <span class="m">9</span><span class="o">⍴</span><span class="m">0</span>
<span class="nv">config</span><span class="na">.</span><span class="nv">results</span> <span class="kd">←</span> <span class="no">⍬</span>
<span class="nv">config</span> <span class="kd">←</span> <span class="nv">random_player</span> <span class="nv">config</span>
<span class="nv">config</span><span class="na">.</span><span class="nv">game</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 0 0 0 0 0
0 0 0 0 1 0 0 0 0
</span></div></div>
</div>
<p>If we run <code class="docutils literal notranslate"><span class="pre">random_player</span></code> again it will make a move for <code class="docutils literal notranslate"><span class="pre">×</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">config</span> <span class="kd">←</span> <span class="nv">random_player</span> <span class="nv">config</span>
<span class="nv">config</span><span class="na">.</span><span class="nv">game</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 0 0 0 0 0
0 0 0 0 1 0 0 0 0
0 0 0 0 1 2 0 0 0
</span></div></div>
</div>
<p>It would get rather tedious if we had to manually run <code class="docutils literal notranslate"><span class="pre">random_player</span></code> every time we wanted to make another move. APL has a power operator <code class="docutils literal notranslate"><span class="pre">⍣</span></code> which we can use to execute something repeatedly.</p>
<p>The code below creates a fresh configuration and then runs the <code class="docutils literal notranslate"><span class="pre">random_player</span></code> 9 times.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">config</span><span class="na">.</span><span class="nv">game</span> <span class="kd">←</span> <span class="p">(</span><span class="m">1</span> <span class="m">9</span><span class="o">⍴</span><span class="m">0</span><span class="p">)</span>
<span class="nv">config</span><span class="na">.</span><span class="nv">results</span> <span class="kd">←</span> <span class="m">0</span>
<span class="nv">config</span><span class="kd">←</span><span class="p">(</span><span class="nv">random_player</span> <span class="na">⍣</span> <span class="m">9</span><span class="p">)</span> <span class="nv">config</span>
<span class="nv">config</span><span class="na">.</span><span class="nv">game</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 1 0 0
0 0 2 0 0 0 1 0 0
0 1 2 0 0 0 1 0 0
0 1 2 0 2 0 1 0 0
0 1 2 0 2 0 1 1 0
0 1 2 0 2 2 1 1 0
0 1 2 0 2 2 1 1 1
2 1 2 0 2 2 1 1 1
2 1 2 1 2 2 1 1 1
</span></div></div>
</div>
<p>What happens if we try to play again?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">config</span> <span class="kd">←</span> <span class="nv">random_player</span> <span class="nv">config</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DOMAIN ERROR
random_player[0] random_player←{g←⍵.game ⋄ cp←p g ⋄ i←⍸e←0=cp ⋄ cp[i[?+/e]]←np
      cp ⋄ ⍵.game←g⍪cp ⋄ ⍵}
                                                                    ∧
</pre></div>
</div>
</div>
</div>
<p>The board is full and our code falls over. That’s a problem with our code.</p>
<p>There’s another problem with our design so far. <em>There’s nothing to stop the game when a player has won</em>.</p>
<p>Luckily these problems are not hard to fix.</p>
<p>We can use the <code class="docutils literal notranslate"><span class="pre">try</span></code> user-defined operator to stop invoking the player as soon as the game is over. We saw above that our first attpemt at play failed if we carried on beyond the 9th move.</p>
<p>TODO: Define the syntax for user defined operators.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span> <span class="nv">draw</span> <span class="kd">←</span> <span class="kt">{</span><span class="m">0</span><span class="o">=+</span><span class="na">/</span><span class="m">0</span><span class="o">=</span><span class="bp">⍵</span><span class="kt">}</span> <span class="c1">⍝ is the game drawn?</span>
 <span class="nv">gf</span> <span class="kd">←</span><span class="nv">wf</span> <span class="o">∨</span> <span class="nv">draw</span> <span class="c1">⍝ the game is finished if it&#39;s been won or the board is full</span>
 <span class="nv">try</span><span class="kd">←</span><span class="kt">{</span><span class="nv">gf</span> <span class="nv">p</span> <span class="bp">⍵</span><span class="na">.</span><span class="nv">game</span><span class="bp">:⍵</span> <span class="p">⋄</span> <span class="bp">⍺⍺</span> <span class="bp">⍵</span><span class="kt">}</span> <span class="c1">⍝ if the game is over, do nothing; otherwise invoke the player</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s repeat our new code 10 times and see if it copes OK.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">init</span> <span class="kd">←</span> <span class="kt">{</span><span class="bp">⍵</span><span class="na">.</span><span class="nv">game</span> <span class="kd">←</span> <span class="p">(</span><span class="m">1</span> <span class="m">9</span><span class="o">⍴</span><span class="m">0</span><span class="p">)</span> <span class="p">⋄</span> <span class="bp">⍵</span><span class="na">.</span><span class="nv">results</span> <span class="kd">←</span> <span class="m">0</span> <span class="p">⋄</span> <span class="bp">⍵</span> <span class="kt">}</span>
<span class="nv">config</span> <span class="kd">←</span> <span class="nv">init</span> <span class="nf">⎕ns</span> <span class="s1">&#39;&#39;</span>
<span class="nv">config</span><span class="kd">←</span><span class="p">(</span><span class="kt">{</span><span class="nv">random_player</span> <span class="nv">try</span> <span class="bp">⍵</span><span class="kt">}</span> <span class="na">⍣</span> <span class="m">10</span><span class="p">)</span> <span class="nv">config</span>
<span class="nv">list</span> <span class="nv">config</span><span class="na">.</span><span class="nv">game</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┬───┬───┬───┬───┬───┬───┬───┬───┐
│...│...│.○.│.○.│.○○│×○○│×○○│×○○│×○○│×○○│
│...│...│...│...│...│...│...│.×.│○×.│○××│
│...│×..│×..│××.│××.│××.│××○│××○│××○│××○│
└───┴───┴───┴───┴───┴───┴───┴───┴───┴───┘
</span></div></div>
</div>
<p>Great! Even when we run it ten times, the code stops adding moves as soon as the game is over.</p>
<p>At the moment we can only play games with <code class="docutils literal notranslate"><span class="pre">random_player</span></code>s, but later we will want to use other types of player. We’ll write a <code class="docutils literal notranslate"><span class="pre">play_round</span></code> operator which will take two functions, one the left, one on the right, and create a function that</p>
<ol class="simple">
<li><p>takes a configuration as its arguiment</p></li>
<li><p>asks the function on the left to make a move</p></li>
<li><p>asks the function on the right to make a move</p></li>
<li><p>then returns the updated configuration</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">play_round</span> <span class="kd">←</span> <span class="kt">{</span><span class="bp">⍺⍺</span> <span class="nv">try</span> <span class="bp">⍵</span> <span class="p">⋄</span> <span class="bp">⍵</span> <span class="bp">⍵⍵</span> <span class="nv">try</span> <span class="bp">⍵</span> <span class="p">⋄</span> <span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">config</span> <span class="kd">←</span> <span class="nv">init</span> <span class="nf">⎕ns</span> <span class="s1">&#39;&#39;</span>
<span class="nv">config</span> <span class="kd">←</span> <span class="kt">{</span><span class="nv">random_player</span> <span class="nv">play_round</span> <span class="nv">random_player</span> <span class="bp">⍵</span><span class="kt">}</span> <span class="nv">config</span> 
<span class="nv">config</span><span class="na">.</span><span class="nv">game</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 1 0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">config</span> <span class="kd">←</span> <span class="kt">{</span><span class="nv">random_player</span> <span class="nv">play_round</span> <span class="nv">random_player</span> <span class="bp">⍵</span><span class="kt">}</span> <span class="nv">config</span> 
<span class="nv">config</span><span class="na">.</span><span class="nv">game</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 1 0
0 0 0 2 0 0 0 1 0
</span></div></div>
</div>
<p>We need to update the history before we can write <code class="docutils literal notranslate"><span class="pre">game_runner</span></code>.</p>
<p>It will update the confiuration history with the result of the last game and return the updated configuration.</p>
<p>We’ll start by writing <code class="docutils literal notranslate"><span class="pre">result</span></code> to find the result of the last game.</p>
<p><code class="docutils literal notranslate"><span class="pre">result</span></code> will check if the game was drawn, and if so it will return a 0.
If not, it will check the number of empty squares. If the count is even, the <code class="docutils literal notranslate"><span class="pre">x</span></code> played last and must have won, so it will return a 1. If the count is odd, <code class="docutils literal notranslate"><span class="pre">○</span></code> played last and the game was lost, so it will return a ¯1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">result</span> <span class="kd">←</span> <span class="kt">{</span> <span class="nv">draw</span> <span class="nv">p</span> <span class="bp">⍵:</span> <span class="m">0</span> <span class="p">⋄</span> <span class="m">1</span> <span class="m">¯1</span><span class="sr">[</span><span class="m">2</span> <span class="o">|</span> <span class="o">+</span><span class="na">/</span><span class="m">0</span><span class="o">=</span><span class="nv">p</span> <span class="bp">⍵</span><span class="sr">]</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can develop <code class="docutils literal notranslate"><span class="pre">game_runner</span></code>.</p>
<p>It will start by setting a new starting postion in the configuration it’s given.</p>
<p>It will use a different invocation of <code class="docutils literal notranslate"><span class="pre">⍣</span></code>, the power operator. Previously we used a numeric right argument,
and the power operator invoked the function that number of times. Now we’ll use a function as the right argument. In effect, that will be a <em>stop</em> function. the power operator will repeat the function on its left, applying the function on its right to the old and new values returned, until the function on its right returns a <code class="docutils literal notranslate"><span class="pre">1</span></code>. The function we’ll use is <em>same</em>, represented by <code class="docutils literal notranslate"><span class="pre">≡</span></code>. <code class="docutils literal notranslate"><span class="pre">same</span></code> returns a 1 if its arguments are identical.</p>
<p><code class="docutils literal notranslate"><span class="pre">game_runner</span></code> will repeatedly play a round until two succesive game states are the same.That will happen as soon as the game is over.</p>
<p>Then it will invoke <code class="docutils literal notranslate"><span class="pre">uh</span></code> to update the configuration with the game result and return the updated configuration.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">game_runner</span> <span class="kd">←</span> <span class="kt">{</span><span class="bp">⍵</span><span class="na">.</span><span class="nv">game</span> <span class="kd">←</span> <span class="m">1</span> <span class="m">9</span><span class="o">⍴</span><span class="m">0</span> <span class="p">⋄</span> <span class="nv">tmp</span> <span class="kd">←</span> <span class="p">(</span><span class="bp">⍺⍺</span> <span class="nv">play_round</span> <span class="bp">⍵⍵</span><span class="p">)</span><span class="na">⍣</span><span class="m">9</span><span class="o">⊢</span><span class="bp">⍵</span> <span class="p">⋄</span> <span class="bp">⍵</span><span class="na">.</span><span class="nv">results</span> <span class="kd">←</span> <span class="bp">⍵</span><span class="na">.</span><span class="nv">results</span><span class="o">,</span> <span class="nv">result</span> <span class="bp">⍵</span><span class="na">.</span><span class="nv">game</span> <span class="p">⋄</span> <span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">config</span> <span class="kd">←</span> <span class="nv">init</span> <span class="nf">⎕ns</span> <span class="s1">&#39;&#39;</span>
<span class="nv">config</span> <span class="kd">←</span> <span class="nv">random_player</span> <span class="nv">game_runner</span> <span class="nv">random_player</span><span class="o">⊢</span><span class="nv">config</span>
<span class="nv">config</span><span class="na">.</span><span class="nv">game</span>
<span class="nv">config</span><span class="na">.</span><span class="nv">results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 1 0 0
0 0 2 0 0 0 1 0 0
0 1 2 0 0 0 1 0 0
0 1 2 2 0 0 1 0 0
0 1 2 2 0 1 1 0 0
0 1 2 2 0 1 1 2 0
0 1 2 2 1 1 1 2 0
2 1 2 2 1 1 1 2 0
2 1 2 2 1 1 1 2 1
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">config</span> <span class="kd">←</span> <span class="nv">random_player</span> <span class="nv">game_runner</span> <span class="nv">random_player</span><span class="o">⊢</span><span class="nv">config</span>
<span class="nv">config</span><span class="na">.</span><span class="nv">game</span>
<span class="nv">config</span><span class="na">.</span><span class="nv">results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 0 0 0 0 0
0 0 1 0 0 0 0 0 0
0 0 1 0 0 0 0 2 0
0 1 1 0 0 0 0 2 0
0 1 1 2 0 0 0 2 0
0 1 1 2 1 0 0 2 0
0 1 1 2 1 0 2 2 0
0 1 1 2 1 1 2 2 0
0 1 1 2 1 1 2 2 2
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 ¯1
</span></div></div>
</div>
<p>Let’s play twenty more games and see the results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">config</span> <span class="kd">←</span> <span class="kt">{</span><span class="nv">random_player</span> <span class="nv">game_runner</span> <span class="nv">random_player</span><span class="o">⊢</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍣</span><span class="m">20</span><span class="o">⊢</span><span class="nv">config</span>
<span class="nv">config</span><span class="na">.</span><span class="nv">results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 ¯1 0 ¯1 1 0 ¯1 1 1 0 ¯1 ¯1 0 0 ¯1 1 1 ¯1 ¯1 ¯1 0 1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">)</span><span class="nv">save</span> <span class="nv">notebook7</span> <span class="o">-</span><span class="nv">force</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">notebook7.dws saved Wed Dec 23 11:09:34 2020
</span></div></div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "dyalog-kernel"
        },
        kernelOptions: {
            kernelName: "dyalog-kernel",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'dyalog-kernel'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="chapter-5.html" title="previous page">Finding the next move</a>
    <a class='right-next' id="next-link" href="chapter-7.html" title="next page">Implementing A Simplified MENACE Player</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Romilly Cocking<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-26986725-2', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    
  </body>
</html>