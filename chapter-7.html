
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Implementing A Simplified MENACE Player &#8212; MENACE Revisited</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Appendix A - Exploring Dyalog APL" href="appendix-a.html" />
    <link rel="prev" title="Playing the game" href="chapter-6.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/Tic_Tac_Toe.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">MENACE Revisited</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="an-introduction.html">
   Reinforcement Learning From The Ground Up
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-1.html">
   Reinforcement Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-2.html">
   Reinforcement Learning with MENACE
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-3.html">
   Exploring the game
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-4.html">
   Possible games
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-5.html">
   Finding the next move
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-6.html">
   Playing the game
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Implementing A Simplified MENACE Player
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="appendix-a.html">
   Appendix A - Exploring Dyalog APL
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="appendix-b.html">
   Ten minutes to RIDE
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="appendix-c.html">
   Running MENACE In RIDE
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="about-the-author.html">
   About the author
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/chapter-7.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/romilly/o-x-o"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/romilly/o-x-o/issues/new?title=Issue%20on%20page%20%2Fchapter-7.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/romilly/o-x-o/master?urlpath=tree/chapter-7.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tracking-menace-s-beads">
   Tracking MENACE’s Beads
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#menace-s-learning-rule">
   MENACE’s Learning Rule
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simplifying-and-extending-menace-s-approach">
   Simplifying And Extending MENACE’s Approach
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="implementing-a-simplified-menace-player">
<h1>Implementing A Simplified MENACE Player<a class="headerlink" href="#implementing-a-simplified-menace-player" title="Permalink to this headline">¶</a></h1>
<div class="section" id="tracking-menace-s-beads">
<h2>Tracking MENACE’s Beads<a class="headerlink" href="#tracking-menace-s-beads" title="Permalink to this headline">¶</a></h2>
<p>The original MATCHBOX-based MENACE remembered the lessons from past games using matchboxes and beads.</p>
<ol class="simple">
<li><p>It used one matchbox for each board position that MENACE might enounter.</p></li>
<li><p>Each machbox was labelled. The label showed the position represented by the box, and showed each possible move from that position. Possible moves were shown in different colours.</p></li>
<li><p>Each matchbox contained beads of colours that matched those on the label. The beads determined the probability that MENACE would make the corresponding move.</p></li>
</ol>
<p>In our implementation we will maintain the bead information as a two element vector, with each element an array.</p>
<p>The first element will be a vector of decoded (numerical) positions.
The second element will be a matrix of bead counts, with one row per possible position and 9 columns.</p>
<p>Each column will corespond to one of the possible moves from the position, and will contain the number of virtual beads corresponding to that move. Some moves will not be possible because the sqare is already occupied. We will initialse the bead counts for such positions to zero, and the counts will never get updated, since the correponding moves will never be made.</p>
<p>TODO: Add illustration of a position (in vector and display form) and its bead counts</p>
<p>The values for possible moves will be initialised to some fixed number when a new MENACE configuration is created, and will then get adjusted at the end of each game by MENACE’s learning rule.</p>
<p>The bead data will form a new third element of the MENACE configuration.</p>
</div>
<div class="section" id="menace-s-learning-rule">
<h2>MENACE’s Learning Rule<a class="headerlink" href="#menace-s-learning-rule" title="Permalink to this headline">¶</a></h2>
<p>At the end of a game MENACE adjusted the bead counts.</p>
<ol class="simple">
<li><p>If MENACE <em>won</em> it added three beads of the same colour matching those picked during the game.</p></li>
<li><p>If MENACE <em>drew</em> it added one bead of the appropriate colour to each matchbox used.</p></li>
<li><p>If MENACE <em>lost</em> it removed three beads of the appropriate colour from each matchbox used.</p></li>
</ol>
<p>We’ll extend <code class="docutils literal notranslate"><span class="pre">game_runner</span></code> to do the same to our virtual bead counts.</p>
<p>Let’s start by copying in our earlier work.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">)</span><span class="nv">copy</span> <span class="nv">notebook7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">done
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">./notebook7.dws saved Wed Dec 23 07:22:04 2020
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕io</span> <span class="kd">←</span> <span class="m">0</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="simplifying-and-extending-menace-s-approach">
<h2>Simplifying And Extending MENACE’s Approach<a class="headerlink" href="#simplifying-and-extending-menace-s-approach" title="Permalink to this headline">¶</a></h2>
<p>In his original design for MENACE, Donald Michie eliminated redundant board positions from consideration and specified that MENACE always made the first move.</p>
<p>He did this in order to reduce the number of machboxes required to a manageable number. A secondary benefit was that one game could provide reinforement for a whole family of symetric versions.</p>
<p>Since we are representing the matchboxed by values in an array we are not constrained in the same way, and the time taken to train the system is also less of a problem.</p>
<p>We’ll also allow a <code class="docutils literal notranslate"><span class="pre">menace_player</span></code> to be the first or second player.</p>
<p>We would need more code to match a real game position to its canonical representation, so we won’t do so in this chapter. We could maintain a virtual matchbox for beads for every  possible position, but many of those could never occur in play. We can reduce the 19683 positions considerably by using the <code class="docutils literal notranslate"><span class="pre">ok</span></code> function which checks the number of <code class="docutils literal notranslate"><span class="pre">×</span></code>s and <code class="docutils literal notranslate"><span class="pre">○</span></code>s.</p>
<p>Let’s see how many positions are <code class="docutils literal notranslate"><span class="pre">ok</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">all</span> <span class="kd">←</span> <span class="nv">encode</span> <span class="nv">numbers</span><span class="kd">←</span> <span class="o">⍳</span><span class="m">3</span><span class="o">*</span><span class="m">9</span> <span class="c1">⍝ all possible positions</span>
<span class="nv">ok</span><span class="kd">←</span><span class="kt">{</span><span class="m">0</span> <span class="m">1</span><span class="o">∊</span><span class="na">⍨</span><span class="o">-</span><span class="na">⌿</span><span class="o">+</span><span class="na">/</span><span class="m">1</span> <span class="m">2</span><span class="na">∘.</span><span class="o">=</span><span class="bp">⍵</span><span class="kt">}</span>      <span class="c1">⍝ do positions have counts of × and ○ that could occur in play?</span>
<span class="nv">good</span> <span class="kd">←</span> <span class="p">(</span><span class="nv">ok</span> <span class="nv">all</span><span class="p">)</span><span class="na">/</span><span class="nv">numbers</span>    <span class="c1">⍝ find numbers of all positions that are ok</span>
<span class="o">⍴</span><span class="nv">good</span>                      <span class="c1">⍝ how many positions are ok?</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">6046
</span></div></div>
</div>
<p>Six thousand and forty-six would be a lot of matchboxes, but an APL array of that size is not a problem on a modern computer.</p>
<p>We’ll maintain virtual bean counts for each position in <code class="docutils literal notranslate"><span class="pre">good</span></code>.</p>
<p>The bead data has three parts which we’ll store in the configuration Namespace.</p>
<p>The first is <code class="docutils literal notranslate"><span class="pre">config.good</span></code> - a vector of decoded positions.</p>
<p>The second is <code class="docutils literal notranslate"><span class="pre">config.beads</span></code> a matrix of bead counts, with one row for each position in <code class="docutils literal notranslate"><span class="pre">good</span></code>, and nine columns correspnding to the nine squares on the board. Each column shoud contain the initial bean count for those positions that are empty, and zero for each position that has already been filled.</p>
<p>We’ll also need to keep track of the beads that were selected by a menace player, so that we can adjust the bead counts when the game is over. We’ll look at how to do that below.</p>
<p>Let’s sart by initialising the virtual bead data. MENACE started with 20 beads in each matchbox, but we will make the starting count to a changeable parameter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">starting_count</span> <span class="kd">←</span> <span class="m">20</span>
<span class="nv">bc</span> <span class="kd">←</span> <span class="p">((</span><span class="o">⍴</span><span class="nv">good</span><span class="p">)</span><span class="o">,</span><span class="m">9</span><span class="p">)</span><span class="o">⍴</span> <span class="nv">starting_count</span>
</pre></div>
</div>
</div>
</div>
<p>Now we need to set the bead counts to zero for each position that has been filled.</p>
<p>We’ll do that in stages. First we’ll convert encode values in <code class="docutils literal notranslate"><span class="pre">good</span></code>, That will give us a matrix <code class="docutils literal notranslate"><span class="pre">gbp</span></code> with one good board position in each row and one column per square of the board.</p>
<p>Next we’ll look for the zeros in <code class="docutils literal notranslate"><span class="pre">gbp</span></code>, keep the corresponding positions of bead counts unchanged, and set the rest to zero.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">gbp</span> <span class="kd">←</span> <span class="nv">encode</span> <span class="nv">good</span> <span class="c1">⍝ a matrix with one board position per row</span>
<span class="nv">zero</span> <span class="kd">←</span> <span class="m">0</span><span class="o">=</span><span class="nv">gbp</span> <span class="c1">⍝ a matrix with a 1 for each non-empty position and a 0 for every empty one.</span>
<span class="nv">bc</span> <span class="kd">←</span> <span class="nv">bc</span> <span class="o">×</span> <span class="nv">zero</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">list</span> <span class="m">5</span><span class="o">↑</span><span class="nv">gbp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┬───┬───┬───┐
│...│...│...│...│...│
│...│...│...│...│...│
│...│..×│.×.│.×○│.○×│
└───┴───┴───┴───┴───┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">5</span><span class="o">↑</span><span class="nv">bc</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">20 20 20 20 20 20 20 20 20
20 20 20 20 20 20 20 20  0
20 20 20 20 20 20 20  0 20
20 20 20 20 20 20 20  0  0
20 20 20 20 20 20 20  0  0
</span></div></div>
</div>
<p>That looks correct. Let’s turn that into a function <code class="docutils literal notranslate"><span class="pre">initial_counts</span></code> which will take an array of positions as its left argument and the number of intial counts as its right argument.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">initial_counts</span> <span class="kd">←</span> <span class="kt">{</span> <span class="nv">bc</span> <span class="kd">←</span> <span class="p">((</span><span class="o">⍴</span><span class="bp">⍺</span><span class="p">)</span><span class="o">,</span><span class="m">9</span><span class="p">)</span><span class="o">⍴</span> <span class="bp">⍵</span> <span class="p">⋄</span> <span class="nv">bc</span> <span class="o">×</span> <span class="m">0</span><span class="o">=</span><span class="nv">encode</span> <span class="bp">⍺</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span><span class="nv">good</span> <span class="nv">initial_counts</span> <span class="m">20</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">6046 9
</span></div></div>
</div>
<p>Now we can easily create the extended initial configuration.</p>
<p>We’ll write a function called <code class="docutils literal notranslate"><span class="pre">initialise</span></code> which will create the initial configuration.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">initialise</span> <span class="kd">←</span> <span class="kt">{</span><span class="p">(</span><span class="m">1</span> <span class="m">9</span><span class="o">⍴</span><span class="m">0</span><span class="p">)</span> <span class="no">⍬</span> <span class="p">((</span><span class="bp">⍺</span><span class="p">)</span> <span class="p">(</span><span class="bp">⍺</span> <span class="nv">initial_counts</span> <span class="bp">⍵</span><span class="p">))</span><span class="kt">}</span>
<span class="nv">config</span> <span class="kd">←</span> <span class="nv">good</span> <span class="nv">initialise</span> <span class="m">20</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can start work on the implementation of <code class="docutils literal notranslate"><span class="pre">menace_player</span></code>.</p>
<p>Like the <code class="docutils literal notranslate"><span class="pre">random_player</span></code>, our <code class="docutils literal notranslate"><span class="pre">menace_player</span></code> function should expect a menace configuration as its argument, work out how to move, and return an updated configuration as its result.</p>
<p>It will work out which move to make by looking at the bead counts for each move it could make from the current position and chosing one at random. The probablilty of each possible move should reflect the proportion of beads allocated to that move.</p>
<p>We’ll also need to work out how to give the <code class="docutils literal notranslate"><span class="pre">game_runner</span></code> the data it needs to update the bead counts when the game is over.</p>
<p>Let’s start by writing a function that will pick a move index given a vector of bead counts.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">beads</span> <span class="kd">←</span> <span class="m">2</span> <span class="m">0</span> <span class="m">1</span> <span class="m">0</span> <span class="m">3</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">4</span>
<span class="nv">pick</span> <span class="kd">←</span> <span class="kt">{</span><span class="p">(</span><span class="m">0</span><span class="o">,+</span><span class="na">\</span><span class="bp">⍵</span><span class="p">)</span><span class="o">⍸?+</span><span class="na">/</span><span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pick</span></code> uses two APL primitives that we have not used before.</p>
<p><em>Scan</em>, represented by <code class="docutils literal notranslate"><span class="pre">\</span></code>, is with <code class="docutils literal notranslate"><span class="pre">+</span></code> used to create a running total.</p>
<p><em>Interval Index</em>, represented by <code class="docutils literal notranslate"><span class="pre">⍸</span></code>, allows us to find which position corresponds to the random number created by <code class="docutils literal notranslate"><span class="pre">?</span></code>.</p>
<p>Let’s try out <code class="docutils literal notranslate"><span class="pre">pick</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">pick</span> <span class="nv">beads</span> <span class="c1">⍝ NB: the result may change each time this is run!</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">4
</span></div></div>
</div>
<p>Let’s do a more thorough analysis.</p>
<p>The code below creates a 100,000 element vector in which each element is the enclosed character vector <code class="docutils literal notranslate"><span class="pre">pick</span> <span class="pre">beads</span></code>. It then uses <em>execute each</em> <code class="docutils literal notranslate"><span class="pre">⍎¨</span></code> to execute each of those statements. It uses <em>outer product equals</em> <code class="docutils literal notranslate"><span class="pre">∘.=</span></code> to create a table with a 1 for each occurence of the nine possible values, and adds up each row using <em>plus reduction</em> <code class="docutils literal notranslate"><span class="pre">+/</span></code>. That givuse a count of hom many times each possible value was chosen.</p>
<p>Then it divides that by the total which is the number of trials. That gives us a vector of probabilites.</p>
<p>For the given value of <code class="docutils literal notranslate"><span class="pre">beads</span></code> we would expect those to be 0.2 0 01. 0 0.3 0 0 0 0.4 and the results we get are close to the theoretical values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">picks</span> <span class="kd">←</span> <span class="o">⍎</span><span class="na">¨</span><span class="m">100000</span><span class="o">⍴⊂</span><span class="s1">&#39;pick beads&#39;</span>
<span class="nv">counts</span> <span class="kd">←</span> <span class="o">+</span><span class="na">/</span><span class="p">(</span><span class="o">⍳</span><span class="m">9</span><span class="p">)</span><span class="na">∘.</span><span class="o">=</span> <span class="nv">picks</span>
<span class="nv">counts</span><span class="o">÷+</span><span class="na">/</span><span class="nv">counts</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0.20051 0 0.0998 0 0.29799 0 0 0 0.4017
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">cfp</span> <span class="kd">←</span> <span class="kt">{</span><span class="nv">good</span> <span class="nv">counts</span> <span class="kd">←</span> <span class="m">2</span><span class="o">⊃</span><span class="bp">⍺</span> <span class="p">⋄</span> <span class="nv">counts</span><span class="sr">[</span><span class="nv">good</span><span class="o">⍳</span><span class="nv">decode</span> <span class="bp">⍵</span><span class="sr">;]</span> <span class="kt">}</span>
<span class="nv">menace_player</span> <span class="kd">←</span> <span class="kt">{</span><span class="nv">g</span> <span class="kd">←</span> <span class="nv">cg</span> <span class="bp">⍵</span> <span class="p">⋄</span> <span class="nv">cp</span> <span class="kd">←</span> <span class="nv">p</span> <span class="nv">g</span> <span class="p">⋄</span> <span class="nv">cp</span><span class="sr">[</span><span class="nv">pick</span> <span class="bp">⍵</span> <span class="nv">cfp</span> <span class="nv">cp</span><span class="sr">]</span> <span class="kd">←</span> <span class="nv">np</span> <span class="nv">cp</span> <span class="p">⋄</span> <span class="nv">g</span> <span class="kd">←</span> <span class="nv">g</span><span class="o">⍪</span><span class="nv">cp</span> <span class="p">⋄</span> <span class="bp">⍵</span> <span class="nv">ucg</span> <span class="nv">g</span> <span class="kt">}</span>
<span class="nv">config</span> <span class="kd">←</span> <span class="nv">menace_player</span> <span class="nv">config</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">↑</span><span class="nv">config</span> <span class="kd">←</span> <span class="nv">menace_player</span> <span class="nv">game_runner</span> <span class="nv">random_player</span><span class="o">⊢</span><span class="nv">config</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────────────────┬─┐
│0 0 0 0 0 0 0 0 0│0│
│0 0 0 0 1 0 0 0 0│ │
│0 2 0 0 1 0 0 0 0│ │
│0 2 0 0 1 1 0 0 0│ │
│0 2 0 0 1 1 0 0 2│ │
│1 2 0 0 1 1 0 0 2│ │
│1 2 2 0 1 1 0 0 2│ │
│1 2 2 0 1 1 1 0 2│ │
│1 2 2 2 1 1 1 0 2│ │
│1 2 2 2 1 1 1 1 2│ │
└─────────────────┴─┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="o">⊃</span><span class="nv">config</span> <span class="kd">←</span> <span class="kt">{</span><span class="nv">menace_player</span> <span class="nv">game_runner</span> <span class="nv">random_player</span><span class="o">⊢</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍣</span><span class="m">100</span><span class="o">⊢</span><span class="nv">config</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 ¯1 0 0 1 ¯1 0 ¯1 1 1 0 0 1 0 1 ¯1 0 1 1 0 0 ¯1 ¯1 ¯1 0 ¯1 1 1 0 ¯1 ¯1 0 0 ¯1 

      0 ¯1 0 1 ¯1 1 1 0 ¯1 1 1 0 ¯1 ¯1 1 ¯1 ¯1 ¯1 0 1 ¯1 1 0 1 ¯1 1 1 0 ¯1 ¯1 ¯

      1 1 1 ¯1 ¯1 ¯1 ¯1 1 0 1 ¯1 1 ¯1 0 1 0 ¯1 1 1 1 1 1 ¯1 0 ¯1 ¯1 0 ¯1 0 0 ¯1

       ¯1 1 1 0 0 1
</span></div></div>
</div>
<p>That’s encouraging, but it points out our remaining problem: the current code uses bead counts but it does not update them so it is not learning.</p>
<p>Fixing that needs a bit of thought.</p>
<p>We can’t just change <code class="docutils literal notranslate"><span class="pre">menace_player</span></code>. If <code class="docutils literal notranslate"><span class="pre">menace_player</span></code> is the first player, and the second player wins, the <code class="docutils literal notranslate"><span class="pre">meance_player</span></code> will not be invoked after the win, so it can’t update the bead counts.</p>
<p>We can’t just change <code class="docutils literal notranslate"><span class="pre">game_runner</span></code>.
To fix that we need to make two changes - one to <code class="docutils literal notranslate"><span class="pre">game_runner</span></code> and one to <code class="docutils literal notranslate"><span class="pre">menace_player</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">game_runner</span></code> knows when a game is over, and can find the result from <code class="docutils literal notranslate"><span class="pre">config</span></code>. It needs to update bead counts for every move made by a</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">)</span><span class="nv">save</span> <span class="nv">notebook8</span> <span class="o">-</span><span class="nv">force</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">notebook8.dws saved Wed Dec 23 07:24:08 2020
</span></div></div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "dyalog-kernel"
        },
        kernelOptions: {
            kernelName: "dyalog-kernel",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'dyalog-kernel'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="chapter-6.html" title="previous page">Playing the game</a>
    <a class='right-next' id="next-link" href="appendix-a.html" title="next page">Appendix A - Exploring Dyalog APL</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Romilly Cocking<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-26986725-2', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    
  </body>
</html>