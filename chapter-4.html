
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Playing the game &#8212; MENACE Revisited</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Appendix A - Exploring Dyalog APL" href="appendix-a.html" />
    <link rel="prev" title="Reinforcement Learning with MENACE" href="chapter-3.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/Tic_Tac_Toe.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">MENACE Revisited</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-1.html">
   Reinforcement Learning from the ground up
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-2.html">
   Reinforcement Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-3.html">
   Reinforcement Learning with MENACE
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Playing the game
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="appendix-a.html">
   Appendix A - Exploring Dyalog APL
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="about-the-author.html">
   About the author
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/chapter-4.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/romilly/o-x-o"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/romilly/o-x-o/issues/new?title=Issue%20on%20page%20%2Fchapter-4.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/romilly/o-x-o/master?urlpath=tree/chapter-4.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-symmetries">
   Using symmetries
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#canonical-representations">
   Canonical representations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#defining-a-position-s-canonical-representation">
     Defining a position’s canonical representation
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="playing-the-game">
<h1>Playing the game<a class="headerlink" href="#playing-the-game" title="Permalink to this headline">¶</a></h1>
<p>In this notebook we’ll start looking at how to play the game.</p>
<p>First, we’ll load in the work we did on symmetries in the previous notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">)</span><span class="nv">copy</span> <span class="nv">notebook3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">done
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">./notebook3.dws saved Sat Dec 12 17:46:18 2020
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">)</span><span class="nv">fns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">decode  encode  list    m       r       show    
</span></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">)vars</span></code> is another useful system command. It shows us the names of the variables that <code class="docutils literal notranslate"><span class="pre">)copy</span></code> brought in for us.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">)</span><span class="nv">vars</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">board1  boards  encoded hereDir i       mi      mr180   mr270   mr90    r180    r270    r90     start   symmetries      
</span></div></div>
</div>
<p>As we saw earlier, <code class="docutils literal notranslate"><span class="pre">⎕io</span></code> is <em>not</em> copied, so we’ll need to set it to zero.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕io</span> <span class="kd">←</span> <span class="m">0</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="using-symmetries">
<h2>Using symmetries<a class="headerlink" href="#using-symmetries" title="Permalink to this headline">¶</a></h2>
<p>Let’s start by looking at how we can use our work on symmetries to reduce the number of board positions we need to consider when playing.</p>
<p>For any given board position there are up to seven other positions that are equivalent to it.</p>
<p>Why did I say <em>up to</em>?</p>
<p>Some board configurations are symmetric, so some transformations will leave them unchanged.</p>
<p>Here’s an extreme example. Imagine that <code class="docutils literal notranslate"><span class="pre">x</span></code> has played in the centre of the board.
The board is the same whether you rotate it, reflect it, combine rotations and reflections or leave it unchanged.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span> <span class="o">⊢</span> <span class="nv">symmetric</span> <span class="kd">←</span> <span class="m">3</span> <span class="m">3</span><span class="o">⍴</span><span class="s1">&#39;....×....&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">...
.×.
...
</span></div></div>
</div>
<p>To examine the symmetries using APL we need to convert the board to its vector representation.</p>
<p>Let’s create a function to do that.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">see</span><span class="kd">←</span><span class="kt">{{</span><span class="o">,</span><span class="s1">&#39;.×○&#39;</span><span class="o">⍳</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍤</span><span class="m">2</span><span class="o">⊣</span><span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>It’s a little more complicated than you might expect because it can handle arrays of boards as well as individual boards.</p>
<p>Let’s try it out.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊢</span> <span class="nv">sym</span> <span class="kd">←</span> <span class="nv">see</span> <span class="nv">symmetric</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 1 0 0 0 0
</span></div></div>
</div>
<p>You can think of <code class="docutils literal notranslate"><span class="pre">see</span></code> as an inverse to <code class="docutils literal notranslate"><span class="pre">show</span></code>.</p>
<p>Let’s check the symmetric transformations on the board.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">sym</span><span class="sr">[</span><span class="nv">symmetries</span><span class="sr">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 1 0 0 0 0
0 0 0 0 1 0 0 0 0
0 0 0 0 1 0 0 0 0
0 0 0 0 1 0 0 0 0
0 0 0 0 1 0 0 0 0
0 0 0 0 1 0 0 0 0
0 0 0 0 1 0 0 0 0
0 0 0 0 1 0 0 0 0
</span></div></div>
</div>
<p>They are all identical (as they should be).</p>
<p>How can we get rid of the redundant copies?</p>
<p>APL has a primitive function <em>Unique</em> represented as <code class="docutils literal notranslate"><span class="pre">∪</span></code> which does just that.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∪</span><span class="nv">sym</span><span class="sr">[</span><span class="nv">symmetries</span><span class="sr">]</span> <span class="c1">⍝ the unique version</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 1 0 0 0 0
</span></div></div>
</div>
<p>Let’s look at a position with some symmetry.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊢</span> <span class="nv">asymmetric</span> <span class="kd">←</span> <span class="m">3</span> <span class="m">3</span><span class="o">⍴</span><span class="s1">&#39;.×.×○×...&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">.×.
×○×
...
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="nv">less</span> <span class="kd">←</span> <span class="nv">see</span> <span class="nv">asymmetric</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 1 0 1 2 1 0 0 0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">less</span><span class="sr">[</span><span class="nv">symmetries</span><span class="sr">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 1 0 1 2 1 0 0 0
0 1 0 0 2 1 0 1 0
0 0 0 1 2 1 0 1 0
0 1 0 1 2 0 0 1 0
0 1 0 1 2 1 0 0 0
0 1 0 1 2 0 0 1 0
0 0 0 1 2 1 0 1 0
0 1 0 0 2 1 0 1 0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∪</span><span class="nv">less</span><span class="sr">[</span><span class="nv">symmetries</span><span class="sr">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 1 0 1 2 1 0 0 0
0 1 0 0 2 1 0 1 0
0 0 0 1 2 1 0 1 0
0 1 0 1 2 0 0 1 0
</span></div></div>
</div>
<p>Now there are four distinct transformations.</p>
<p>Let’s see what they are.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊂</span><span class="na">⍤</span><span class="m">2</span> <span class="nv">show</span> <span class="o">∪</span><span class="nv">less</span><span class="sr">[</span><span class="nv">symmetries</span><span class="sr">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┬───┬───┐
│.×.│.×.│...│.×.│
│×○×│.○×│×○×│×○.│
│...│.×.│.×.│.×.│
└───┴───┴───┴───┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">show</span> <span class="nv">board1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">××.
.○○
.×.
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊂</span><span class="na">⍤</span><span class="m">2</span> <span class="nv">show</span> <span class="o">∪</span><span class="nv">board1</span><span class="sr">[</span><span class="nv">symmetries</span><span class="sr">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┬───┬───┬───┬───┬───┬───┐
│××.│..×│.×.│.○.│.××│×..│.×.│.○.│
│.○○│×○×│○○.│×○×│○○.│×○×│.○○│×○×│
│.×.│.○.│.××│×..│.×.│.○.│××.│..×│
└───┴───┴───┴───┴───┴───┴───┴───┘
</span></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">board1</span></code> is asymmetric and so it has eight distinct symmetries.</p>
</div>
<div class="section" id="canonical-representations">
<h2>Canonical representations<a class="headerlink" href="#canonical-representations" title="Permalink to this headline">¶</a></h2>
<p>In order to apply Michie’s first simplification we need a way of converting every board position to <em>just one</em> of its symmetries.</p>
<p>We’ll use the idea of a <em>canonical representation</em>. I’ve borrowed that term from Mathematics, but the mathematical details don’t matter to us.
You’ll see how we create and use canonical representations in below.</p>
<div class="section" id="defining-a-position-s-canonical-representation">
<h3>Defining a position’s canonical representation<a class="headerlink" href="#defining-a-position-s-canonical-representation" title="Permalink to this headline">¶</a></h3>
<p>As we’ve seen, every board position is a member of a set of one to eight boards which can be regarded as the same as far as the game is concerned.</p>
<p>The functions <code class="docutils literal notranslate"><span class="pre">encode</span></code> and <code class="docutils literal notranslate"><span class="pre">decode</span></code> allow us to switch between the vector representation of the position and a number in the range zero to 19682.</p>
<p>The symmetries of a given position form a set of up to eight vectors, and each vector can be converted to its unique number using <code class="docutils literal notranslate"><span class="pre">decode</span></code>.</p>
<p>We’ll take the smallest of those numbers and use that as the canonical representation of the position.</p>
<p>Let’s do that for the boards we just considered: <code class="docutils literal notranslate"><span class="pre">sym</span></code>, <code class="docutils literal notranslate"><span class="pre">less</span></code> and <code class="docutils literal notranslate"><span class="pre">board1</span></code>.
We are going to perform the same operation on each, so we can save time by defining a function to do it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">canonical</span> <span class="kd">←</span> <span class="kt">{</span> <span class="o">⌊</span><span class="na">⌿</span> <span class="nv">decode</span> <span class="bp">⍵</span><span class="sr">[</span><span class="nv">symmetries</span><span class="sr">]</span><span class="kt">}</span>
<span class="nv">show</span> <span class="nv">encode</span> <span class="nv">canonical</span> <span class="nv">sym</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">...
.×.
...
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">show</span> <span class="nv">encode</span> <span class="nv">canonical</span> <span class="nv">less</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">...
×○×
.×.
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">show</span> <span class="nv">encode</span> <span class="nv">canonical</span> <span class="nv">board1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">..×
×○×
.○.
</span></div></div>
</div>
<p>Can we find out the canonical representations of all positions?</p>
<p>Let’s try</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">all</span> <span class="kd">←</span> <span class="nv">canonical</span> <span class="nv">encode</span> <span class="o">⍳</span><span class="m">3</span><span class="o">*</span><span class="m">9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RANK ERROR
canonical[0] canonical←{⌊⌿decode ⍵[symmetries]}
                                  ∧
</pre></div>
</div>
</div>
</div>
<p>What’s gone wrong?</p>
<p>We’ve used a simple version of indexing in the definition of canonical.
The <code class="docutils literal notranslate"><span class="pre">[]</span></code> form of indexing corresponds to the notation that is used in a lot of programming languages,
but the format is slightly different for vectors and matrices.
The syntax above works for vectors, but we’re using it with a matrix.</p>
<p>Luckily APL has another form of indexing based on the <code class="docutils literal notranslate"><span class="pre">Index</span></code> function represented as <code class="docutils literal notranslate"><span class="pre">⌷</span></code>.
<code class="docutils literal notranslate"><span class="pre">Index</span></code> can solve the problem we hit above.</p>
<p>You can see how <code class="docutils literal notranslate"><span class="pre">Index</span></code> works in the example below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⊂</span><span class="m">0</span> <span class="m">3</span> <span class="m">2</span><span class="p">)</span><span class="o">⌷</span><span class="m">7</span> <span class="m">8</span> <span class="m">9</span> <span class="m">10</span> <span class="m">20</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">7 10 9
</span></div></div>
</div>
<p>Below you’ll see a function I’ve called <code class="docutils literal notranslate"><span class="pre">ild</span></code>, which is short for <em>index last dimension</em>.</p>
<p>Here’s the definition for <code class="docutils literal notranslate"><span class="pre">ild</span></code>, along with an updated definition of canonical.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ild</span> <span class="kd">←</span> <span class="kt">{</span><span class="p">(</span><span class="o">⊂</span><span class="bp">⍺</span><span class="p">)</span> <span class="o">⌷</span><span class="sr">[</span><span class="m">¯1</span><span class="o">+⍴⍴</span><span class="bp">⍵</span><span class="sr">]</span><span class="bp">⍵</span><span class="kt">}</span> <span class="c1">⍝ index last dimension</span>
<span class="nv">canonical</span> <span class="kd">←</span> <span class="kt">{</span><span class="o">⌊</span><span class="na">⌿</span><span class="nv">decode</span> <span class="nv">symmetries</span> <span class="nv">ild</span> <span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span> <span class="nv">canonical</span> <span class="nv">encode</span> <span class="o">⍳</span><span class="m">3</span><span class="o">*</span><span class="m">9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">19683
</span></div></div>
</div>
<p>How many of these are distinct? We’d exepect quite a few repetitions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴</span> <span class="o">∪</span> <span class="nv">canonical</span> <span class="nv">encode</span> <span class="o">⍳</span><span class="m">3</span><span class="o">*</span><span class="m">9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2862
</span></div></div>
</div>
<p>That’s a big simlification, but we can further reduce the number of board positions by elimination some of the positions that can’t crop up in  play.</p>
<p>One example: in any valid board position, there will be one fewer <code class="docutils literal notranslate"><span class="pre">○</span></code>s than <code class="docutils literal notranslate"><span class="pre">×</span></code>s after the first player has moved, and the number of <code class="docutils literal notranslate"><span class="pre">×</span></code> and <code class="docutils literal notranslate"><span class="pre">○</span></code> chaarcters will be the same after the second player has moved.</p>
<p>If we count the number of ones and twos in the vector represenation, for any valid board position the number of ones will be the same or one greater than the number of twos.</p>
<p>There’s a neat way to check than in APL. Below you’ll see the approach working on a small set of position vectors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊢</span> <span class="nv">samples</span> <span class="kd">←</span> <span class="nv">encode</span> <span class="m">0</span> <span class="m">1</span> <span class="m">9</span> <span class="m">10</span> <span class="m">11</span> <span class="m">18</span> <span class="m">20</span> <span class="m">19682</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 1
0 0 0 0 0 0 1 0 0
0 0 0 0 0 0 1 0 1
0 0 0 0 0 0 1 0 2
0 0 0 0 0 0 2 0 0
0 0 0 0 0 0 2 0 2
2 2 2 2 2 2 2 2 2
</span></div></div>
</div>
<p>Of these, let’s decide which are valid by counting the 1#s and 2’ by eye:</p>
<p><code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span></code> is valid</p>
<p><code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">1</span></code> is valid</p>
<p><code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">1</span> <span class="pre">0</span> <span class="pre">0</span></code> is valid</p>
<p><code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">1</span> <span class="pre">0</span> <span class="pre">1</span></code> is <strong>invalid</strong> because <code class="docutils literal notranslate"><span class="pre">×</span></code> has played twice but <code class="docutils literal notranslate"><span class="pre">○</span></code> has not played at all</p>
<p><code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">1</span> <span class="pre">0</span> <span class="pre">2</span></code> is valid</p>
<p><code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">2</span> <span class="pre">0</span> <span class="pre">0</span></code> is <strong>invalid</strong>, because <code class="docutils literal notranslate"><span class="pre">○</span></code> has played before <code class="docutils literal notranslate"><span class="pre">×</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">2</span> <span class="pre">0</span> <span class="pre">2</span></code> is <strong>invalid</strong> because <code class="docutils literal notranslate"><span class="pre">○</span></code> has played twice but <code class="docutils literal notranslate"><span class="pre">×</span></code> has not played at all</p>
<p><code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">2</span> <span class="pre">2</span> <span class="pre">2</span> <span class="pre">2</span> <span class="pre">2</span> <span class="pre">2</span> <span class="pre">2</span> <span class="pre">2</span></code> is <strong>invalid</strong>, because <code class="docutils literal notranslate"><span class="pre">○</span></code> has binged and covered the whole board!</p>
<p>How can we implement these rules in APL?</p>
<p>Let’s start by consindering the vector <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">1</span> <span class="pre">0</span> <span class="pre">2</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">v</span> <span class="kd">←</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">1</span> <span class="m">0</span> <span class="m">2</span>
<span class="m">1</span> <span class="m">2</span> <span class="na">∘.</span><span class="o">=</span> <span class="nv">v</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0 0 0 0 0 1 0 0
0 0 0 0 0 0 0 0 1
</span></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">∘.=</span></code> is an <em>equals outer product</em>. It produces an array which shows where each value in the argument on its left is equal to each value in the argument on its right.</p>
<p>In this case, one argument is a 2-element vector and the other is a 9 element vector so the result is a 2 by 9 matric of zeros and ones.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">/</span><span class="m">1</span> <span class="m">2</span> <span class="na">∘.</span><span class="o">=</span> <span class="nv">v</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1
</span></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">+/</span></code> is a <em>plus reduction</em>. It sums the values along the first dimension of n array.</p>
<p>In this case it totals the number of 0s and the number of 1s in the original vector.</p>
<p>We can find the difference between the counts of 1s and 2s by applying <code class="docutils literal notranslate"><span class="pre">-/</span></code>. That’s a <em>minus reduction</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="na">/</span><span class="o">+</span><span class="na">/</span><span class="m">1</span> <span class="m">2</span> <span class="na">∘.</span><span class="o">=</span> <span class="nv">v</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<p>That tells us that the number of <code class="docutils literal notranslate"><span class="pre">×</span></code>s and <code class="docutils literal notranslate"><span class="pre">○</span></code>s is the same.</p>
<p>Let’s put that code in a function I’ve named <em>cd</em> (short for count difference) and try another vector.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">cd</span> <span class="kd">←</span> <span class="kt">{</span><span class="o">-</span><span class="na">/</span><span class="o">+</span><span class="na">/</span><span class="m">1</span> <span class="m">2</span> <span class="na">∘.</span><span class="o">=</span><span class="bp">⍵</span><span class="kt">}</span> 
<span class="nv">cd</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">1</span> <span class="m">0</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">2
</span></div></div>
</div>
<p>This tells us that there are two more <code class="docutils literal notranslate"><span class="pre">×</span></code>s than <code class="docutils literal notranslate"><span class="pre">○</span></code>s, which means that the position cannto occur in play.</p>
<p>For the position to be possible the difference must be 0 or 1.</p>
<p>APL has a primitive function <em>membership</em>, represented by <code class="docutils literal notranslate"><span class="pre">∊</span></code>, which returns a 0 for each element on its left that is’nt in the vector on its right.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span> <span class="m">2</span> <span class="m">0</span> <span class="m">5</span> <span class="m">1</span> <span class="m">2</span> <span class="o">∊</span> <span class="m">0</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 0 1 0 1 0
</span></div></div>
</div>
<p>We can check the result of <code class="docutils literal notranslate"><span class="pre">cd</span></code> using <code class="docutils literal notranslate"><span class="pre">∊</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">cd</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">1</span> <span class="m">0</span> <span class="m">1</span><span class="p">)</span> <span class="o">∊</span> <span class="m">0</span> <span class="m">1</span> <span class="c1">⍝ not a possible position</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">cd</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">1</span> <span class="m">2</span> <span class="m">1</span><span class="p">)</span> <span class="o">∊</span> <span class="m">0</span> <span class="m">1</span> <span class="c1">⍝ a possible position</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<p>Those brackets are distracting. The code would be easier to read if tthe arguments to <code class="docutils literal notranslate"><span class="pre">∊</span></code> were reversed.</p>
<p>APL has an operator <em>switch</em> <code class="docutils literal notranslate"><span class="pre">⍨</span></code> to do that!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span> <span class="m">1</span> <span class="o">∊</span><span class="na">⍨</span> <span class="nv">cd</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">1</span> <span class="m">2</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In APL a <em>function</em> returns data as its result. An <em>operator</em> corresponds to what other languages call a <em>higher order function</em>. It takes functions and/or data and returns a <em>function</em> as its result</p>
</div>
<p>Let’s create a new function that will determine if a given position is ok (in otehr words, possible).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ok</span> <span class="kd">←</span> <span class="kt">{</span><span class="m">0</span> <span class="m">1</span> <span class="o">∊</span><span class="na">⍨</span> <span class="nv">cd</span> <span class="bp">⍵</span><span class="kt">}</span>
<span class="nv">ok</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">1</span> <span class="m">2</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ok</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">1</span> <span class="m">0</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0
</span></div></div>
</div>
<p>What happens if we apply it to a matrix?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ok</span> <span class="nv">samples</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">0 0
</span></div></div>
</div>
<p>That’s not right. The problem is that cd works on a vector but not a matrix. One small change will fix that.</p>
<p>We need to make sure that the minus reduction will always be applied to the first dimension of its argument.</p>
<p>Here’s the uopdated <code class="docutils literal notranslate"><span class="pre">cd</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">cd</span> <span class="kd">←</span> <span class="kt">{</span><span class="o">-</span><span class="na">⌿</span><span class="o">+</span><span class="na">/</span><span class="m">1</span> <span class="m">2</span> <span class="na">∘.</span><span class="o">=</span><span class="bp">⍵</span><span class="kt">}</span>
<span class="nv">ok</span> <span class="nv">samples</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 1 1 0 1 0 0 0
</span></div></div>
</div>
<p>Let’s check that the updated code has picked the possible configurations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">list</span> <span class="nv">samples</span><span class="na">⌿⍨</span><span class="nv">ok</span> <span class="nv">samples</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬───┬───┬───┐
│...│...│...│...│
│...│...│...│...│
│...│..×│×..│×.○│
└───┴───┴───┴───┘
</span></div></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "dyalog-kernel"
        },
        kernelOptions: {
            kernelName: "dyalog-kernel",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'dyalog-kernel'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="chapter-3.html" title="previous page">Reinforcement Learning with MENACE</a>
    <a class='right-next' id="next-link" href="appendix-a.html" title="next page">Appendix A - Exploring Dyalog APL</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Romilly Cocking<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-26986725-2', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    
  </body>
</html>